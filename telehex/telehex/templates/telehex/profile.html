{% extends "base.html" %}
{% load staticfiles %}
{% load ratings_helper %}
{% include "./telehex/header.html" %}


{% block title %}- {{ user.nickname }}'s Profile{% endblock %}

{%block content %}
<div class="container">
    <!-- heading title -->
    <div class="profile-title-styling">
        <h1>Hello, {{user.nickname}}</h1>
    </div>
    <!-- don't allow them to view stats if they have not subscribed to any shows -->
    {% if shows %}
    <!-- create the options bar to take you to statistics -->
        <div class="caption-styling show_padding">
            <h2>Your Subscribed Shows</h2>
            <a href="/profile/stats" class="stats_link"> View your user statistics </a>
        </div>
    <!-- hexagons and descriptions inside thumbnails -->
    <div>
            {% for show, next in shows %}
                <div class="col-sm-4">
                    {% if show.fanart %}
                        <div class="hex-im-cont thumbnail thumbnail-styling">
                            <a href="/show/{{show.url_string}}"><img src="/hexagons/{{ show.key.name }}" class="hex-im img-responsive" alt="{{show.name}} hex image"></a>
                            {% if next.airdate %}
                                <span style="display: none" class="airdate">{{ next.airdate }}</span>
                                <h2 class="days-left" style="display: none"> On in </h2>
                            {% elif show.status == "On Hiatus" %}
                                <h2 class="days-left" style="display: none"> On Hiatus </h2>
                            {% elif show.status == "Ended" %}
                                <h2 class="days-left" style="display: none"> Ended </h2>
                            {% elif show.status == "Other" %}
                                <h2 class="days-left" style="display: none"> Unknown </h2>
                            {% elif show.status == "Continuing" %}
                                <h2 class="days-left" style="display: none"> Next airdate to be confirmed </h2>
                            {% endif %}
                        </div>

                        <div class="caption caption-styling">
                            <div class="title-styling"><a href="/show/{{show.url_string}}">{{ show.title }}</a></div>
                            {% if show.rating %} 
                            <div class="hex_styling">
                                {{show.rating|to_num_hex}}
                            </div> 
                            {% endif %}
                            <p>
                            {% if next.name %}Next Episode: {{ next.name }}{% endif %}<br> 
                            {% if next.name %}Airdate: {{ next.airdate }}{% endif %}<br>
                            </p>
                            <br>
                        </div>

                    {% else %}
                        <img src="{% static "img/errorhex.png" %}" class="hex-im-error img-responsive" alt="No Show Image">
                    {% endif %} 
                </div>
            {% endfor %}
    </div>
    {% else %}
        <p>It doesn't look like you've subscribed to any shows. Try <a href="/">searching</a> for some and subscribing to them!</p>
    {% endif %}
</div>
{% endblock %}

{%block scripts %}
<script>

function daysUntil(dateString){
    if(dateString === "")
        return "";
    
    var now = Date.parse(new Date().toDateString()),
    dateEnd = Date.parse(dateString),
    days = (dateEnd - now) / 1000/60/60/24;   // convert milliseconds to days
    return days;
}

// Wait until the document is loaded before doing any jQuery
$(document).ready(function(){
    // Get all the hex-images with airdates
    var images = $(".hex-im-cont").children(".airdate");

    // For each hex-image work out the day until it next airs and append this to the string in the hover
    images.each(function(){
        var daysleft = daysUntil($( this ).text());
        if(daysleft === 0)
            $( this ).siblings(".days-left").text("Today");
        else if (daysleft === 1)
            $( this ).siblings(".days-left").text("Tomorrow");
        else
            $( this ).siblings(".days-left").append(daysleft + " days!");
        
        $( this ).siblings(".days-left").hide();
    });

    // Specify a function that gets executed on hex-image hover
    $(".hex-im").hover(function(){
        // Image is being hovered over - add the hover class
        $(this).addClass("hover");
        // Show the days left
        $(this).parent().siblings(".days-left").show();
    }, function(){
        // Image is being left 
        $(this).removeClass("hover");
        $(this).parent().siblings(".days-left").hide();
    });

    // Function to prevent flickering when days left div is hovered over
    $(".days-left").hover(function(){
        $(this).siblings("a").children(".hex-im").mouseenter();
    }, function(){
        $(this).siblings("a").children(".hex-im").mouseleave();
    });
});


</script>
{% endblock %}
